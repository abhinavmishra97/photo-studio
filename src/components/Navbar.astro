---
import ThemeToggle from "./ThemeToggle.astro";

const navItems = [
  { name: "About Us", link: "/about-us" },
  { name: "Gallery", link: "/gallery" },

  {
    name: "Still Photography",
    link: "/still-photography",
    items: [
      { name: "Studio Photography", link: "/still-photography#studio" },
      { name: "Matrimonial Snaps", link: "/still-photography#matrimonial" },
      { name: "Baby Photoshoot", link: "/still-photography#baby" },
      { name: "Product Photo Shoot", link: "/still-photography#product" },
      { name: "Outdoor Photography", link: "/specialised#outdoor" },
    ],
  },

  {
    name: "Videography",
    link: "/videography",
    items: [
      { name: "Cinematography", link: "/videography#cinematography" },
      { name: "Invitation Video", link: "/videography#invitation" },
      { name: "Teasers", link: "/videography#teasers" },
      { name: "Video Mixing", link: "/videography#mixing" },
      { name: "Drone", link: "/videography#drone" },
      { name: "Wall LED", link: "/videography#wallled" },
    ],
  },

  {
    name: "Printing Solutions",
    link: "/printing-solutions",
    items: [
      { name: "Large Format Printing", link: "/printing-solutions#largeformat" },
      { name: "Scanning A0 Size", link: "/printing-solutions#scanning" },
      { name: "Cameo 5 Cutting", link: "/printing-solutions#cameo" },
      { name: "Copier / Printing", link: "/printing-solutions#copier" },
    ],
  },

  {
    name: "Gifts Items",
    link: "/gifts-items",
    items: [
      { name: "Sublimation Items", link: "/gifts#sublimation" },
      { name: "Cushions", link: "/gifts#cushions" },
      { name: "LED Items", link: "/gifts#led" },
      { name: "Magic Cups", link: "/gifts#magiccups" },
      { name: "Magic Mirrors", link: "/gifts#magicmirrors" },
      { name: "Key Rings", link: "/gifts#keyrings" },
      { name: "Color Cups", link: "/gifts#colorcups" },
    ],
  },

  { name: "Contact", link: "/contact" },
];

const path = Astro.url.pathname;
---

<nav
  class="
    w-full sticky top-0 z-50
    bg-[#1F1C19] text-[#EDEAE6]
    dark:bg-[#1F1C19] dark:text-[#EEEAE3]
    border-b border-[#3F3C38]
    shadow-sm transition-colors duration-300
  "
>
  <div class="max-w-7xl mx-auto flex justify-between items-center px-4 py-3 md:px-6 md:py-4">

    <!-- Logo -->
    <a
      href="/"
      class="
        text-xl md:text-3xl font-bold tracking-wide
        hover:text-[#D4A373]
        transition
      "
    >
      Ram Digital Photo Studio
    </a>

    <!-- Desktop Menu -->
    <ul class="hidden md:flex items-center space-x-8">
      {navItems.map((item) => {
        const dropdownId = item.name.toLowerCase().replace(/\s+/g, "-");

        return (
          <li class="relative group">

            <div class="flex items-center gap-1">
              <a
                href={item.link ?? "#"}
                class={`text-sm md:text-base transition
                  hover:text-[#D4A373]
                  ${
                    path.startsWith(item.link ?? "___")
                      ? "text-[#D4A373] font-semibold"
                      : ""
                  }
                `}
              >
                {item.name}
              </a>

              {item.items && (
                <button
                  onclick={`toggleDropdown('${dropdownId}')`}
                  class="
                    text-xs
                    text-[#CFC6BC]
                    group-hover:text-[#D4A373]
                    transition-transform group-hover:rotate-180
                  "
                >
                  ▼
                </button>
              )}
            </div>

            <!-- Dropdown -->
            {item.items && (
              <ul
                id={dropdownId}
                class="
                  dropdown hidden absolute left-0 mt-3 w-56
                  bg-[#2A2724] dark:bg-[#1A1816]
                  border border-[#3F3C38] dark:border-[#2A2724]
                  rounded-lg shadow-lg py-2
                  opacity-0 translate-y-3
                  transition-all duration-300
                "
              >
                {item.items.map((sub) => (
                  <li>
                    <a
                      href={sub.link}
                      class="
                        block px-4 py-2
                        text-[#EDEAE6]
                        hover:bg-[#36322D]
                        hover:text-[#D4A373]
                        transition
                      "
                    >
                      {sub.name}
                    </a>
                  </li>
                ))}
              </ul>
            )}
          </li>
        );
      })}
    </ul>

    <!-- Theme Toggle -->
    <div class="hidden md:block">
      <ThemeToggle />
    </div>

    <!-- Mobile Button -->
    <button
      id="mobileMenuBtn"
      class="md:hidden text-3xl text-[#EDEAE6]"
      aria-label="Toggle menu"
    >
      ☰
    </button>
  </div>

  <!-- Mobile Menu -->
  <div
    id="mobileMenu"
    class="
      fixed inset-y-0 right-0 w-1/2 max-w-xs
      translate-x-full
      md:hidden
      bg-[#1F1C19] text-[#EDEAE6]
      px-6 pb-6 pt-4 space-y-2
      border-l border-[#3F3C38]
      shadow-xl transition-transform duration-300
      overflow-y-auto
    "
  >
    {navItems.map((item) =>
      item.items ? (
        <details class="border-b border-[#3F3C38] pb-2">
          <summary class="cursor-pointer py-2 text-lg">
            {item.name}
          </summary>
          <ul class="ml-2 mt-1 space-y-1">
            {item.items.map((sub) => (
              <li>
                <a
                  href={sub.link}
                  class="
                    block py-2 text-sm
                    hover:text-[#D4A373]
                    transition
                  "
                >
                  {sub.name}
                </a>
              </li>
            ))}
          </ul>
        </details>
      ) : (
        <a
          href={item.link}
          class="
            block py-2 text-lg border-b border-[#3F3C38]
            hover:text-[#D4A373]
            transition
          "
        >
          {item.name}
        </a>
      )
    )}

    <ThemeToggle />
  </div>
</nav>

<script is:inline>
  function toggleDropdown(id) {
    const dropdown = document.getElementById(id);

    document.querySelectorAll(".dropdown").forEach((el) => {
      if (el.id !== id) {
        el.classList.add("hidden", "opacity-0", "translate-y-3");
      }
    });

    dropdown.classList.toggle("hidden");
    setTimeout(() => {
      dropdown.classList.toggle("opacity-0");
      dropdown.classList.toggle("translate-y-3");
    }, 10);
  }

  document.addEventListener("click", (e) => {
    if (
      e.target.closest("#themeToggleBtn") ||
      e.target.closest("#mobileMenuBtn") ||
      e.target.closest("#mobileMenu")
    ) return;

    if (!e.target.closest("li")) {
      document.querySelectorAll(".dropdown").forEach((el) => {
        el.classList.add("hidden", "opacity-0", "translate-y-3");
      });
    }
  });

  const btn = document.getElementById("mobileMenuBtn");
  const mobileMenu = document.getElementById("mobileMenu");

  btn.addEventListener("click", () => {
    const isOpen = mobileMenu.classList.contains("translate-x-0");
    if (isOpen) {
      mobileMenu.classList.remove("translate-x-0");
      mobileMenu.classList.add("translate-x-full");
    } else {
      mobileMenu.classList.remove("translate-x-full");
      mobileMenu.classList.add("translate-x-0");
    }
  });
</script>
