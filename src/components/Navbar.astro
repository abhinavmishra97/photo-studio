---

const navItems = [
  { name: "About Us", link: "/about-us" },
  { name: "Gallery", link: "/gallery" },
  {
    name: "Services",
    link: "#",
    items: [
      { name: "Still Photography", link: "/still-photography" },
      { name: "Videography", link: "/videography" },
      { name: "Printing Solutions", link: "/printing-solutions" },
      { name: "Gift Items", link: "/gifts-items" },
    ],
  },
  { name: "Contact", link: "/contact" },
];

const path = Astro.url.pathname;
---

<nav
  class="
    w-full sticky top-0 z-40
    bg-gradient-to-b from-[#FBF7F2] via-[#F5EFE0] to-[#E8D5B5]
    text-[#1a1a1a]
    border-b-2 border-[#E8D5B5]
    shadow-lg transition-all duration-300
    hidden md:block
  "
>
  <div class="max-w-7xl mx-auto flex justify-between items-center px-4 py-2 md:px-6 md:py-3">

    <!-- Logo - Left Side -->
    <a
      href="/"
      class="
        text-xl md:text-2xl font-bold tracking-wide text-[#1a1a1a]
        hover:scale-110 hover:drop-shadow-[0_0_8px_rgba(26,26,26,0.4)]
        transition-all duration-300
      "
    >
      Ram Digital Photo Studio
    </a>

    <!-- Desktop Menu - Right Side -->
    <ul class="flex items-center space-x-8">
      {navItems.map((item) => {
        const dropdownId = item.name.toLowerCase().replace(/\s+/g, "-");
        
        // Check if current page is active
        const isActive = path.startsWith(item.link) && item.link !== "#";
        
        // Check if any service page is active (for Services dropdown)
        const isServiceActive = item.name === "Services" && (
          path.startsWith("/still-photography") ||
          path.startsWith("/videography") ||
          path.startsWith("/printing-solutions") ||
          path.startsWith("/gifts-items")
        );

        return (
          <li class="relative group">

            <div class="flex items-center gap-1">
              <a
                href={item.link ?? "#"}
                class={`text-sm md:text-base font-semibold transition-all duration-300 text-[#1a1a1a] relative
                  hover:scale-110 hover:text-[#8B6F47] hover:drop-shadow-[0_0_8px_rgba(139,111,71,0.6)]
                  ${
                    isActive || isServiceActive
                      ? "text-[#8B6F47] after:absolute after:bottom-0 after:left-0 after:w-full after:h-0.5 after:bg-[#8B6F47] after:animate-pulse"
                      : "hover:after:absolute hover:after:bottom-0 hover:after:left-0 hover:after:w-full hover:after:h-0.5 hover:after:bg-[#8B6F47]/70 hover:after:animate-[slideIn_0.3s_ease-in-out]"
                  }
                `}
              >
                {item.name}
              </a>

              {item.items && (
                <span
                  class="
                    text-sm ml-1 text-[#1a1a1a]
                    group-hover:rotate-180 group-hover:scale-125 group-hover:text-[#8B6F47]
                    transition-all duration-300
                  "
                >
                  â–¼
                </span>
              )}
            </div>

            <!-- Dropdown - Shows on hover -->
            {item.items && (
              <ul
                id={dropdownId}
                class="
                  dropdown absolute left-0 mt-2 w-56
                  bg-gradient-to-b from-[#FBF7F2] to-[#F5EFE0]
                  border-2 border-[#E8D5B5]
                  rounded-lg shadow-2xl py-2
                  opacity-0 invisible group-hover:opacity-100 group-hover:visible
                  translate-y-2 group-hover:translate-y-0 scale-95 group-hover:scale-100
                  transition-all duration-300
                "
              >
                {item.items.map((sub) => (
                  <li>
                    <a
                      href={sub.link}
                      class="
                        block px-4 py-2.5
                        text-[#1a1a1a] font-medium
                        hover:bg-[#8B6F47]/20 hover:text-[#8B6F47] hover:translate-x-2
                        transition-all duration-300
                      "
                    >
                      {sub.name}
                    </a>
                  </li>
                ))}
              </ul>
            )}
          </li>
        );
      })}
    </ul>

  </div>
</nav>

<!-- Mobile Navbar - Always visible on mobile -->
<nav class="md:hidden sticky top-0 z-40 bg-gradient-to-b from-[#FBF7F2] via-[#F5EFE0] to-[#E8D5B5] border-b-2 border-[#E8D5B5] shadow-lg">
  <div class="flex justify-between items-center px-4 py-2">
    <!-- Studio Name - Left -->
    <a href="/" class="text-base font-bold text-[#1a1a1a] hover:scale-105 hover:drop-shadow-[0_0_8px_rgba(26,26,26,0.4)] transition-all duration-300">
      Ram Digital Photo Studio
    </a>
    
    <!-- Hamburger Button - Right -->
    <button
      id="mobileMenuBtn"
      class="p-2 rounded-lg hover:bg-[#8B6F47]/20 hover:scale-110 transition-all duration-300"
      aria-label="Toggle menu"
    >
      <div class="hamburger w-5 h-4 flex flex-col justify-between">
        <span class="hamburger-line block h-[2px] w-full bg-[#1a1a1a] transition-all duration-300"></span>
        <span class="hamburger-line block h-[2px] w-full bg-[#1a1a1a] transition-all duration-300"></span>
        <span class="hamburger-line block h-[2px] w-full bg-[#1a1a1a] transition-all duration-300"></span>
      </div>
    </button>
  </div>
</nav>

<!-- Mobile Menu -->
<div
  id="mobileMenu"
  class="
    fixed inset-y-0 right-0 w-3/5 max-w-xs
    translate-x-full
    md:hidden
    bg-[#1F1C19]/95 text-[#EDEAE6]
    backdrop-blur-xl
    px-6 pb-6 pt-20 space-y-2
    border-l border-[#3F3C38]/50
    shadow-2xl transition-transform duration-300
    overflow-y-auto z-40
  "
  style="backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);"
>
  {navItems.map((item) =>
    item.items ? (
      <details class="border-b border-[#3F3C38]/50 pb-2">
        <summary class="cursor-pointer py-2 text-base font-medium">
          {item.name}
        </summary>
        <ul class="ml-3 mt-1 space-y-1">
          {item.items.map((sub) => (
            <li>
              <a
                href={sub.link}
                class="
                  block py-1.5 text-xs
                  hover:text-[#D4A373]
                  transition
                "
              >
                {sub.name}
              </a>
            </li>
          ))}
        </ul>
      </details>
    ) : (
      <a
        href={item.link}
        class="
          block py-2 text-base font-medium border-b border-[#3F3C38]/50
          hover:text-[#D4A373]
          transition
        "
      >
        {item.name}
      </a>
    )
  )}

  <div class="pt-4">

  </div>
</div>

<script is:inline>
  function toggleDropdown(id) {
    const dropdown = document.getElementById(id);

    document.querySelectorAll(".dropdown").forEach((el) => {
      if (el.id !== id) {
        el.classList.add("hidden", "opacity-0", "translate-y-3");
      }
    });

    dropdown.classList.toggle("hidden");
    setTimeout(() => {
      dropdown.classList.toggle("opacity-0");
      dropdown.classList.toggle("translate-y-3");
    }, 10);
  }

  document.addEventListener("click", (e) => {
    if (
      e.target.closest("#mobileMenuBtn") ||
      e.target.closest("#mobileMenu")
    ) return;

    if (!e.target.closest("li")) {
      document.querySelectorAll(".dropdown").forEach((el) => {
        el.classList.add("hidden", "opacity-0", "translate-y-3");
      });
    }
  });

  const btn = document.getElementById("mobileMenuBtn");
  const mobileMenu = document.getElementById("mobileMenu");
  const hamburgerLines = btn.querySelectorAll(".hamburger-line");

  btn.addEventListener("click", () => {
    const isOpen = mobileMenu.classList.contains("translate-x-0");
    if (isOpen) {
      // Close menu
      mobileMenu.classList.remove("translate-x-0");
      mobileMenu.classList.add("translate-x-full");
      
      // Animate back to hamburger
      hamburgerLines[0].style.transform = "rotate(0) translateY(0) translateX(0)";
      hamburgerLines[1].style.opacity = "1";
      hamburgerLines[2].style.transform = "rotate(0) translateY(0) translateX(0)";
    } else {
      // Open menu
      mobileMenu.classList.remove("translate-x-full");
      mobileMenu.classList.add("translate-x-0");
      
      // Animate to cross (X) with margins - shifted 5px right
      hamburgerLines[0].style.transform = "rotate(45deg) translateY(4px) translateX(4px)";
      hamburgerLines[1].style.opacity = "0";
      hamburgerLines[2].style.transform = "rotate(-45deg) translateY(-4px) translateX(4px)";
    }
  });
</script>