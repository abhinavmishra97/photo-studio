---
import ThemeToggle from "./ThemeToggle.astro";

const navItems = [
  { name: "About Us", link: "/about-us" },
  { name: "Gallery", link: "/gallery" },

  {
    name: "Still Photography",
    link: "/still-photography",
    items: [
      { name: "Studio Photography", link: "/still-photography#studio" },
      { name: "Matrimonial Snaps", link: "/still-photography#matrimonial" },
      { name: "Baby Photoshoot", link: "/still-photography#baby" },
      { name: "Product Photo Shoot", link: "/still-photography#product" },
      { name: "Outdoor Photography", link: "/specialised#outdoor" },
    ],
  },

  {
    name: "Videography",
    link: "/videography",
    items: [
      { name: "Cinematography", link: "/videography#cinematography" },
      { name: "Invitation Video", link: "/videography#invitation" },
      { name: "Teasers", link: "/videography#teasers" },
      { name: "Video Mixing", link: "/videography#mixing" },
      { name: "Drone", link: "/videography#drone" },
      { name: "Wall LED", link: "/videography#wallled" },
    ],
  },

  {
    name: "Printing Solutions",
    link: "/printing-solutions",
    items: [
      { name: "Large Format Printing", link: "/printing-solutions#largeformat" },
      { name: "Scanning A0 Size", link: "/printing-solutions#scanning" },
      { name: "Cameo 5 Cutting", link: "/printing-solutions#cameo" },
      { name: "Copier / Printing", link: "/printing-solutions#copier" },
    ],
  },

  {
    name: "Gifts Items",
    link: "/gifts-items",
    items: [
      { name: "Sublimation Items", link: "/gifts#sublimation" },
      { name: "Cushions", link: "/gifts#cushions" },
      { name: "LED Items", link: "/gifts#led" },
      { name: "Magic Cups", link: "/gifts#magiccups" },
      { name: "Magic Mirrors", link: "/gifts#magicmirrors" },
      { name: "Key Rings", link: "/gifts#keyrings" },
      { name: "Color Cups", link: "/gifts#colorcups" },
    ],
  },

  { name: "Contact", link: "/contact" },
];

const path = Astro.url.pathname;
---

<nav
  class="
    w-full sticky top-0 z-40
    bg-[#211D1A] text-[#E8E1D5]
    dark:bg-[#211D1A] dark:text-[#E8E1D5]
    border-b border-[#3E3630]
    shadow-[0_8px_12px_rgba(0,0,0,0.5)] transition-colors duration-300
    hidden md:block
  "
>
  <div class="max-w-7xl mx-auto flex justify-between items-center px-4 py-3 md:px-6 md:py-4">

    <!-- Logo -->
    <a
      href="/"
      class="
        text-xl md:text-2xl font-bold tracking-wide
        hover:text-[#D4A373]
        transition
      "
    >
      Ram Digital Photo Studio
    </a>

    <!-- Desktop Menu -->
    <ul class="hidden md:flex items-center space-x-8">
      {navItems.map((item) => {
        const dropdownId = item.name.toLowerCase().replace(/\s+/g, "-");

        return (
          <li class="relative group">

            <div class="flex items-center gap-1">
              <a
                href={item.link ?? "#"}
                class={`text-sm md:text-base transition
                  hover:text-[#D4A373]
                  ${
                    path.startsWith(item.link ?? "___")
                      ? "text-[#D4A373] font-semibold"
                      : ""
                  }
                `}
              >
                {item.name}
              </a>

              {item.items && (
                <button
                  onclick={`toggleDropdown('${dropdownId}')`}
                  class="
                    text-xs
                    text-[#CFC6BC]
                    group-hover:text-[#D4A373]
                    transition-transform group-hover:rotate-180
                  "
                >
                  â–¼
                </button>
              )}
            </div>

            <!-- Dropdown -->
            {item.items && (
              <ul
                id={dropdownId}
                class="
                  dropdown hidden absolute left-0 mt-3 w-56
                  bg-[#2A2724] dark:bg-[#1A1816]
                  border border-[#3F3C38] dark:border-[#2A2724]
                  rounded-lg shadow-lg py-2
                  opacity-0 translate-y-3
                  transition-all duration-300
                "
              >
                {item.items.map((sub) => (
                  <li>
                    <a
                      href={sub.link}
                      class="
                        block px-4 py-2
                        text-[#EDEAE6]
                        hover:bg-[#36322D]
                        hover:text-[#D4A373]
                        transition
                      "
                    >
                      {sub.name}
                    </a>
                  </li>
                ))}
              </ul>
            )}
          </li>
        );
      })}
    </ul>

    <!-- Theme Toggle -->
    <div class="hidden md:block">
      <ThemeToggle />
    </div>
  </div>
</nav>

<!-- Mobile Menu Button - Fixed in top right (outside nav so always visible) -->
<button
  id="mobileMenuBtn"
  class="md:hidden fixed top-3 right-3 z-50 bg-[#2A2724]/90 backdrop-blur-sm p-2 rounded-lg shadow-lg hover:bg-[#36322D]/95 transition-all"
  aria-label="Toggle menu"
>
  <div class="hamburger w-4 h-3 flex flex-col justify-between">
    <span class="hamburger-line block h-[1px] w-full bg-[#EDEAE6] transition-all duration-300"></span>
    <span class="hamburger-line block h-[1px] w-full bg-[#EDEAE6] transition-all duration-300"></span>
    <span class="hamburger-line block h-[1px] w-full bg-[#EDEAE6] transition-all duration-300"></span>
  </div>
</button>

<!-- Mobile Menu -->
<div
  id="mobileMenu"
  class="
    fixed inset-y-0 right-0 w-3/5 max-w-xs
    translate-x-full
    md:hidden
    bg-[#1F1C19]/95 text-[#EDEAE6]
    backdrop-blur-xl
    px-6 pb-6 pt-20 space-y-2
    border-l border-[#3F3C38]/50
    shadow-2xl transition-transform duration-300
    overflow-y-auto z-40
  "
  style="backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);"
>
  {navItems.map((item) =>
    item.items ? (
      <details class="border-b border-[#3F3C38]/50 pb-2">
        <summary class="cursor-pointer py-2 text-base font-medium">
          {item.name}
        </summary>
        <ul class="ml-3 mt-1 space-y-1">
          {item.items.map((sub) => (
            <li>
              <a
                href={sub.link}
                class="
                  block py-1.5 text-xs
                  hover:text-[#D4A373]
                  transition
                "
              >
                {sub.name}
              </a>
            </li>
          ))}
        </ul>
      </details>
    ) : (
      <a
        href={item.link}
        class="
          block py-2 text-base font-medium border-b border-[#3F3C38]/50
          hover:text-[#D4A373]
          transition
        "
      >
        {item.name}
      </a>
    )
  )}

  <div class="pt-4">
    <ThemeToggle />
  </div>
</div>

<script is:inline>
  function toggleDropdown(id) {
    const dropdown = document.getElementById(id);

    document.querySelectorAll(".dropdown").forEach((el) => {
      if (el.id !== id) {
        el.classList.add("hidden", "opacity-0", "translate-y-3");
      }
    });

    dropdown.classList.toggle("hidden");
    setTimeout(() => {
      dropdown.classList.toggle("opacity-0");
      dropdown.classList.toggle("translate-y-3");
    }, 10);
  }

  document.addEventListener("click", (e) => {
    if (
      e.target.closest("#themeToggleBtn") ||
      e.target.closest("#mobileMenuBtn") ||
      e.target.closest("#mobileMenu")
    ) return;

    if (!e.target.closest("li")) {
      document.querySelectorAll(".dropdown").forEach((el) => {
        el.classList.add("hidden", "opacity-0", "translate-y-3");
      });
    }
  });

  const btn = document.getElementById("mobileMenuBtn");
  const mobileMenu = document.getElementById("mobileMenu");
  const hamburgerLines = btn.querySelectorAll(".hamburger-line");

  btn.addEventListener("click", () => {
    const isOpen = mobileMenu.classList.contains("translate-x-0");
    if (isOpen) {
      // Close menu
      mobileMenu.classList.remove("translate-x-0");
      mobileMenu.classList.add("translate-x-full");
      
      // Animate back to hamburger
      hamburgerLines[0].style.transform = "rotate(0) translateY(0) translateX(0)";
      hamburgerLines[1].style.opacity = "1";
      hamburgerLines[2].style.transform = "rotate(0) translateY(0) translateX(0)";
    } else {
      // Open menu
      mobileMenu.classList.remove("translate-x-full");
      mobileMenu.classList.add("translate-x-0");
      
      // Animate to cross (X) with margins - shifted 5px right
      hamburgerLines[0].style.transform = "rotate(45deg) translateY(4px) translateX(4px)";
      hamburgerLines[1].style.opacity = "0";
      hamburgerLines[2].style.transform = "rotate(-45deg) translateY(-4px) translateX(4px)";
    }
  });
</script>