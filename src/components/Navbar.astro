---
import ThemeToggle from "./ThemeToggle.astro";

const navItems = [
  { name: "About Us", link: "/about-us" },

  {
    name: "Still Photography",
    link: "/still-photography",
    items: [
      { name: "Studio Photography", link: "/still-photography#studio" },
      { name: "Matrimonial Snaps", link: "/still-photography#matrimonial" },
      { name: "Baby Photoshoot", link: "/still-photography#baby" },
      { name: "Product Photo Shoot", link: "/still-photography#product" },
    ],
  },

  {
    name: "Videography",
    link: "/videography",
    items: [
      { name: "Cinematography", link: "/videography#cinematography" },
      { name: "Invitation Video", link: "/videography#invitation" },
      { name: "Teasers", link: "/videography#teasers" },
      { name: "Video Mixing", link: "/videography#mixing" },
      { name: "Drone", link: "/videography#drone" },
      { name: "Wall LED", link: "/videography#wallled" },
    ],
  },

  {
    name: "Printing Solutions",
    link: "/printing-solutions",
    items: [
      { name: "Large Format Printing", link: "/printing-solutions#largeformat" },
      { name: "Scanning A0 Size", link: "/printing-solutions#scanning" },
      { name: "Cameo 5 Cutting", link: "/printing-solutions#cameo" },
      { name: "Copier / Printing", link: "/printing-solutions#copier" },
    ],
  },

  {
    name: "Gifts Items",
    link: "/gifts-items",
    items: [
      { name: "Sublimation Items", link: "/gifts#sublimation" },
      { name: "Cushions", link: "/gifts#cushions" },
      { name: "LED Items", link: "/gifts#led" },
      { name: "Magic Cups", link: "/gifts#magiccups" },
      { name: "Magic Mirrors", link: "/gifts#magicmirrors" },
      { name: "Key Rings", link: "/gifts#keyrings" },
      { name: "Color Cups", link: "/gifts#colorcups" },
    ],
  },

  {
    name: "Specialised In",
    link: "/specialised-in",
    items: [
      { name: "Outdoor Photography", link: "/specialised#outdoor" },
      { name: "Candid Shots", link: "/specialised#candid" },
      { name: "Baby Shower Shoot", link: "/specialised#baby" },
      { name: "Outdoor Studio Setup", link: "/specialised#studiosetup" },
    ],
  },
];


const path = Astro.url.pathname;
---

<nav class="w-full bg-white dark:bg-[#161b22] text-gray-800 dark:text-gray-200 shadow-md sticky top-0 z-50">

  <div class="max-w-7xl mx-auto flex justify-between items-center px-6 py-4">
    
    <!-- Logo -->
    <a href="/" class="text-xl font-bold text-gray-900 dark:text-white">
      Ram Digital Photo Studio
    </a>

    <!-- Desktop Menu -->
    <ul class="hidden md:flex items-center space-x-10">

      {navItems.map((item) => (
        <li class="relative group">
          
          <!-- Main Link -->
          <a href={item.link ?? "#"}
            class={`hover:text-blue-600 dark:hover:text-blue-400 transition ${
              path.startsWith(item.link ?? "___")
                ? "text-blue-600 dark:text-blue-400 font-semibold"
                : ""
            }`}>
            {item.name}
          </a>

          {item.items && (
            <button
              onclick={`toggleDropdown('${item.name}')`}
              class="ml-1 text-sm text-gray-500 dark:text-gray-400 group-hover:text-blue-500 dark:group-hover:text-blue-400 transition-transform group-hover:rotate-180"
            >
              ▼
            </button>
          )}

          <!-- Dropdown -->
          {item.items && (
            <ul
              id={item.name}
              class="dropdown hidden absolute left-0 mt-2 w-56 bg-white dark:bg-[#1f2937] border border-gray-200 dark:border-gray-700 rounded-md shadow-lg py-2 opacity-0 translate-y-3 transition-all duration-300"
            >
              {item.items.map((sub) => (
                <li>
                  <a href={sub.link}
                    class="block px-4 py-2 text-gray-800 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition">
                    {sub.name}
                  </a>
                </li>
              ))}
            </ul>
          )}

        </li>
      ))}

    </ul>

    <div class="hidden md:block">
      <ThemeToggle />
    </div>

    <!-- Mobile Button -->
    <button id="mobileMenuBtn" class="md:hidden text-3xl text-gray-700 dark:text-gray-300">☰</button>

  </div>

  <!-- Mobile Menu -->
  <div id="mobileMenu"
       class="hidden md:hidden bg-white dark:bg-[#161b22] text-gray-900 dark:text-gray-100 px-6 pb-4 space-y-2 shadow">

    {navItems.map(item => (
      item.items ? (
        <details class="border-b border-gray-300 dark:border-gray-700 pb-2">
          <summary class="cursor-pointer py-2 text-lg">{item.name}</summary>
          <ul class="ml-4 mt-1 space-y-1">
            {item.items.map(sub => (
              <li>
                <a href={sub.link}
                   class="block py-2 text-gray-800 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400">
                  {sub.name}
                </a>
              </li>
            ))}
          </ul>
        </details>
      ) : (
        <a href={item.link} class="block py-2 text-lg hover:text-blue-600 dark:hover:text-blue-400">{item.name}</a>
      )
    ))}

    <ThemeToggle />
  </div>

</nav>


<!-- JS -->
<script is:inline>
  function toggleDropdown(id) {
    const dropdown = document.getElementById(id);

    // Close other dropdowns
    document.querySelectorAll(".dropdown").forEach((el) => {
      if (el.id !== id) {
        el.classList.add("hidden", "opacity-0", "translate-y-3");
      }
    });

    // Toggle chosen dropdown
    dropdown.classList.toggle("hidden");
    setTimeout(() => {
      dropdown.classList.toggle("opacity-0");
      dropdown.classList.toggle("translate-y-3");
    }, 10);
  }

  // Auto-close when clicking outside
  document.addEventListener("click", (e) => {
    // Do NOT block theme toggle or mobile menu
    if (
      e.target.closest("#themeToggleBtn") ||
      e.target.closest("#mobileMenuBtn") ||
      e.target.closest("#mobileMenu")
    ) {
      return; // allow click to pass
    }

    // Close dropdown only if clicking outside dropdown area
    if (!e.target.closest("li")) {
      document.querySelectorAll(".dropdown").forEach((el) => {
        el.classList.add("hidden", "opacity-0", "translate-y-3");
      });
    }
  });


  // Mobile menu toggle
  const btn = document.getElementById("mobileMenuBtn");
  const mobileMenu = document.getElementById("mobileMenu");

  btn.addEventListener("click", () => {
    mobileMenu.classList.toggle("hidden");
  });
</script>
